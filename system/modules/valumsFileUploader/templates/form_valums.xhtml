<?php if (!$this->tableless): ?>
    <tr class="<?php echo $this->rowClass; ?>">
        <td class="col_0 col_first"><?php echo $this->generateLabel(); ?></td>
        <td class="col_1 col_last"><?php echo $this->generateWithError(); ?></td>
    </tr>
<?php else: ?>
    <?php echo $this->generateLabel(); ?> 
    <?php echo $this->generateWithError(); ?><br />
<?php endif; ?>

<script type="text/javascript">
    /* <![CDATA[ */
    
    function createUploader(vfu){
        var uploader = new qq.FileUploader({
            // Uploader id
            element: document.getElementById('file-uploader-<?php echo $this->strId; ?>'),
            
            // Path to server-side upload script
            action: '<?php echo $this->action; ?>',
            
            // Get params for request
            params: <?php echo $this->params; ?>,

            // Allowed file extensions
            allowedExtensions: [<?php echo $this->objHelper->getStrExt($this->extensions); ?>],        
            
            // Debug mode to show requests console
            debug: <?php echo ($this->debug) ? "true" : "false"; ?>,
            
            // Size limit
            sizeLimit: <?php echo ($this->val_max_file_length) ? $this->val_max_file_length : '""'; ?>,
            
            // Template wrapper for all items
            template: '<div class="qq-uploader">' + 
                '<div class="qq-upload-drop-area"><span><?php echo (strlen($this->val_drop_text) != 0) ? $this->val_drop_text : $GLOBALS['TL_LANG']['UPL']['fe_upload_drop_area']; ?><\/span><\/div>' +
                '<div class="qq-upload-button"><?php echo (strlen($this->val_init_text) != 0) ? $this->val_init_text :  $GLOBALS['TL_LANG']['UPL']['fe_upload_button']; ?><\/div>' +
                '<ul class="qq-upload-list"><\/ul>' + 
                '<\/div>',
            
            // Template for one item in file list
            fileTemplate: '<li>' +
                <?php if($this->allow_delete) echo "'<a class=\"qq-upload-delete\" href=\"#\" onclick=\"return false;\"><\/a>' +"; ?>
                '<span class="qq-upload-file"><\/span>' +
                '<span class="qq-upload-spinner"><\/span>' +
                '<span class="qq-upload-size"><\/span>' +
                '<a class="qq-upload-cancel" href="#"><?php echo $GLOBALS['TL_LANG']['UPL']['upload_cancel']; ?><\/a>' +
                '<span class="qq-upload-text"><?php echo $GLOBALS['TL_LANG']['UPL']['upload_failed_text']; ?><\/span>' +
                '<\/li>',
            
            // Error messages
            messages: {
                typeError: <?php echo $GLOBALS['TL_LANG']['ERR']['val_type_error']; ?>,
                sizeError: <?php echo $GLOBALS['TL_LANG']['ERR']['val_size_error']; ?>,
                minSizeError: <?php echo $GLOBALS['TL_LANG']['ERR']['val_min_size_error']; ?>,
                emptyError: <?php echo $GLOBALS['TL_LANG']['ERR']['val_empty_error']; ?>,
                onLeave: <?php echo $GLOBALS['TL_LANG']['ERR']['val_on_leave']; ?>          
            },

            /**
             * Run valumsFileUploader class on complete
             */
            onComplete: function(id, fileName, responseJSON){
                vfu.setId(id);
                vfu.setfileName(fileName);
                vfu.setResponseJSON(responseJSON);
                
                vfu.run(id, fileName, responseJSON);
            }
        });        
    }
    
    window.addEvent('domready', function(){
    
        // Create valumsFileUploader object and give them current params
        var vfu = new ValumsFileUploader({
            'fflId' : '<?php echo $this->strId; ?>',
            'detailsFailureMessage' : <?php echo (($this->detailsFailureMessage) ? 'true' : 'false'); ?>,
            'allowDelete' : <?php echo ($this->allow_delete) ? 'true' : 'false'; ?>
        });
        
        // Create ajax-uploader
        createUploader(vfu);
        
        <?php if($this->allow_delete): ?>
        // Add delete file functionality to additional file list after reload the page
        if($('vfu_reload'))
        {
            vfu.addDeleteToReloadElem($('vfu_reload'));
        }
        <?php endif; ?>
    });
    
    /* ]]> */    
</script>